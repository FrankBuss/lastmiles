
Bizarre off the cuff test to show that malloc may spit in
your coffee and kick your dog and just because you free 
a buffer or think it will be zero ... think again.

While we are at it let's try to allocate ALL available
memory and also flush memory in bit patterns and maybe
even push swap a little.

From the man page for "bash" on Red Hat Enterprise Linux 7.4

   ulimit [-HSTabcdefilmnpqrstuvx [limit]]
          Provides  control  over the resources available to the shell
          and to processes started by it, on systems that allow such
          control.  The -H and -S options specify that the hard or soft
          limit is set for the given  resource. A hard limit cannot be
          increased by a non-root user once it is set; a soft limit may
          be increased up to the value of the hard limit.
          If neither -H nor -S is specified, both the soft and hard
          limits are set.  The value of limit can  be a number in the
          unit specified for the resource or one of the special values
          hard, soft, or unlimited, which stand for the current hard
          limit, the current soft limit, and no limit, respectively.
          If limit is omitted, the  current value of the soft limit
          of the resource is printed, unless the -H option is given.
          When more than one resource is specified, the limit name
          and unit are printed before the value.

          Other options are interpreted as follows:
              -a     All current limits are reported
              -b     The maximum socket buffer size
              -c     The maximum size of core files created
              -d     The maximum size of a process's data segment
              -e     The maximum scheduling priority ("nice")
              -f     The maximum size of files written by the shell
                     and its children
              -i     The maximum number of pending signals
              -l     The maximum size that may be locked into memory
              -m     The maximum resident set size (many systems do not
                     honor this limit)
              -n     The maximum number of open file descriptors (most
                     systems do not allow this value to be set)
              -p     The pipe size in 512-byte blocks (this may not be
                     set)
              -q     The maximum number of bytes in POSIX message queues
              -r     The maximum real-time scheduling priority
              -s     The maximum stack size
              -t     The maximum amount of cpu time in seconds
              -u     The maximum number of processes available to a
                     single user
              -v     The maximum amount of virtual memory available to
                     the shell and, on some systems, to its children
              -x     The maximum number of file locks
              -T     The maximum number of threads

              If limit is given, it is the new value of the specified
              resource (the -a option is display only).  If no option
              is given,  then  -f is assumed.  Values are in 1024-byte
              increments, except for -t, which is in seconds, -p, which
              is in units of 512-byte blocks, and -T, -b, -n, and -u,
              which are unscaled values.  The return status is 0 unless
              an invalid option or argument is supplied, or an error
              occurs while setting a new limit.

              In POSIX Mode 512-byte blocks are used for the `-c' 
              and `-f' options.





-------- example data from a Debian Linux x86_64 machine 



styx$ 
styx$ ./maxalloc 2147483648 1048576 262144
START 1568425824.975495977
 NOTE : will try to allocate 2147483648 bytes of memory.
      : we will use an init allocation of 1048576 bytes.
      : with a delta memory allocation of 262144 bytes.
      : Allocated      8 MB    1568425825.15451629 
      : Allocated     16 MB    1568425825.99267822 
      : Allocated     24 MB    1568425825.243468950
      : Allocated     32 MB    1568425825.445495983
      : Allocated     40 MB    1568425825.701784922
      : Allocated     48 MB    1568425826.11606315 
      : Allocated     56 MB    1568425826.373022305
      : Allocated     64 MB    1568425826.789864500
      : Allocated     72 MB    1568425827.256378742
      : Allocated     80 MB    1568425827.776520037
      : Allocated     88 MB    1568425828.349607392
      : Allocated     96 MB    1568425828.976471046
      : Allocated    104 MB    1568425829.655810912
      : Allocated    112 MB    1568425830.388323621
      : Allocated    120 MB    1568425831.174598107
      : Allocated    128 MB    1568425832.18398595 
      : Allocated    136 MB    1568425832.911107104
      : Allocated    144 MB    1568425833.857148060
      : Allocated    152 MB    1568425834.856371978
      : Allocated    160 MB    1568425835.909160880
      : Allocated    168 MB    1568425837.17560658 
      : Allocated    176 MB    1568425838.177156341
      : Allocated    184 MB    1568425839.389539723
      : Allocated    192 MB    1568425840.655147695
      : Allocated    200 MB    1568425841.977872797
      : Allocated    208 MB    1568425843.350426447
      : Allocated    216 MB    1568425844.775839377
      : Allocated    224 MB    1568425846.254646968
      : Allocated    232 MB    1568425847.791698133
      : Allocated    240 MB    1568425849.377041221
      : Allocated    248 MB    1568425851.15835215 
      : Allocated    256 MB    1568425852.710181371
      : Allocated    264 MB    1568425854.455849117
      : Allocated    272 MB    1568425856.255357378
      : Allocated    280 MB    1568425858.110362678
      : Allocated    288 MB    1568425860.15976707 
      : Allocated    296 MB    1568425861.984069208
      : Allocated    304 MB    1568425863.998045750
      : Allocated    312 MB    1568425866.65156959 
      : Allocated    320 MB    1568425868.188895402
      : Allocated    328 MB    1568425870.361525665
      : Allocated    336 MB    1568425872.591512662
      : Allocated    344 MB    1568425874.870268039
      : Allocated    352 MB    1568425877.205813750
      : Allocated    360 MB    1568425879.592482887
      : Allocated    368 MB    1568425882.34897558 
      : Allocated    376 MB    1568425884.527978815
      : Allocated    384 MB    1568425887.77240233 
      : Allocated    392 MB    1568425889.681202552
      : Allocated    400 MB    1568425892.337355316
      : Allocated    408 MB    1568425895.45207700 
      : Allocated    416 MB    1568425897.809029116
      : Allocated    424 MB    1568425900.621702933
      : Allocated    432 MB    1568425903.493957390
      : Allocated    440 MB    1568425906.413979060
      : Allocated    448 MB    1568425909.392588187
      : Allocated    456 MB    1568425912.421367410
      : Allocated    464 MB    1568425915.503323398
      : Allocated    472 MB    1568425918.640393240
      : Allocated    480 MB    1568425921.837736711
      : Allocated    488 MB    1568425925.80632289 
      : Allocated    496 MB    1568425928.381131347
      : Allocated    504 MB    1568425931.730736204
      : Allocated    512 MB    1568425935.132005378
      : Allocated    520 MB    1568425938.590652630
      : Allocated    528 MB    1568425942.99523237 
      : Allocated    536 MB    1568425945.659823778
      : Allocated    544 MB    1568425949.279255849
      : Allocated    552 MB    1568425952.948791135
      : Allocated    560 MB    1568425956.675697793
      : Allocated    568 MB    1568425960.448557024
      : Allocated    576 MB    1568425964.277984241
      : Allocated    584 MB    1568425968.161885419
      : Allocated    592 MB    1568425972.97740523 
      : Allocated    600 MB    1568425976.84972475 
      : Allocated    608 MB    1568425980.126399548
      : Allocated    616 MB    1568425984.230551122
      : Allocated    624 MB    1568425988.383015744
      : Allocated    632 MB    1568425992.586752276
      : Allocated    640 MB    1568425996.845082438
      : Allocated    648 MB    1568426001.154170810
      : Allocated    656 MB    1568426005.516897507
      : Allocated    664 MB    1568426009.935004552
      : Allocated    672 MB    1568426014.405693442
      : Allocated    680 MB    1568426018.930119115
      : Allocated    688 MB    1568426023.507312491
      : Allocated    696 MB    1568426028.139102130
      : Allocated    704 MB    1568426032.824490036
      : Allocated    712 MB    1568426037.564385782
      : Allocated    720 MB    1568426042.360922449
      : Allocated    728 MB    1568426047.206805660
      : Allocated    736 MB    1568426052.104952156
      : Allocated    744 MB    1568426057.59573509 
      : Allocated    752 MB    1568426062.64167138 
      : Allocated    760 MB    1568426067.122141056
      : Allocated    768 MB    1568426072.236634932
      : Allocated    776 MB    1568426077.401942215
      : Allocated    784 MB    1568426082.619243776
      : Allocated    792 MB    1568426087.891920716
      : Allocated    800 MB    1568426093.215259758
      : Allocated    808 MB    1568426098.596351602
      : Allocated    816 MB    1568426104.34996269 
      : Allocated    824 MB    1568426109.520370012
      : Allocated    832 MB    1568426115.58943644 
      : Allocated    840 MB    1568426120.649649128
      : Allocated    848 MB    1568426126.295681346
      : Allocated    856 MB    1568426131.996133482
      : Allocated    864 MB    1568426137.747292331
      : Allocated    872 MB    1568426143.553759307
      : Allocated    880 MB    1568426149.409859937
      : Allocated    888 MB    1568426155.320472897
      : Allocated    896 MB    1568426161.291261676
      : Allocated    904 MB    1568426167.312827789
      : Allocated    912 MB    1568426173.386855254
      : Allocated    920 MB    1568426179.510946660
      : Allocated    928 MB    1568426185.687794189
      : Allocated    936 MB    1568426191.925926473
      : Allocated    944 MB    1568426198.210986817
      : Allocated    952 MB    1568426204.551098877
      : Allocated    960 MB    1568426210.944254131
      : Allocated    968 MB    1568426217.398409498
      : Allocated    976 MB    1568426223.904854212
      : Allocated    984 MB    1568426230.457799303
      : Allocated    992 MB    1568426237.68251774 
      : Allocated   1000 MB    1568426243.726697768
      : Allocated   1008 MB    1568426250.438175006
      : Allocated   1016 MB    1568426257.213041133
      : Allocated   1024 MB    1568426264.30834981 
      : Allocated   1032 MB    1568426270.907311614
      : Allocated   1040 MB    1568426277.840368068
      : Allocated   1048 MB    1568426284.825215519
      : Allocated   1056 MB    1568426291.863553206
      : Allocated   1064 MB    1568426298.951419105
      : Allocated   1072 MB    1568426306.91756465 
      : Allocated   1080 MB    1568426313.289481564
      : Allocated   1088 MB    1568426320.534076845
      : Allocated   1096 MB    1568426327.835283274
      : Allocated   1104 MB    1568426335.185906314
      : Allocated   1112 MB    1568426342.605338456
      : Allocated   1120 MB    1568426350.63798385 
      : Allocated   1128 MB    1568426357.576927827
      : Allocated   1136 MB    1568426365.143016311
      : Allocated   1144 MB    1568426372.765340422
      : Allocated   1152 MB    1568426380.439164189
      : Allocated   1160 MB    1568426388.164591248
      : Allocated   1168 MB    1568426395.940080465
      : Allocated   1176 MB    1568426403.783994126
      : Allocated   1184 MB    1568426411.670459435
      : Allocated   1192 MB    1568426419.603930510
      : Allocated   1200 MB    1568426427.596042377
      : Allocated   1208 MB    1568426435.639064148
      : Allocated   1216 MB    1568426443.739795053
      : Allocated   1224 MB    1568426451.897135809
      : Allocated   1232 MB    1568426460.102075095
      : Allocated   1240 MB    1568426468.370441356
      : Allocated   1248 MB    1568426476.680149406
      : Allocated   1256 MB    1568426485.42482164 
      : Allocated   1264 MB    1568426493.468321476
      : Allocated   1272 MB    1568426501.942479115
      : Allocated   1280 MB    1568426510.465753501
      : Allocated   1288 MB    1568426519.48519294 
      : Allocated   1296 MB    1568426527.692369788
      : Allocated   1304 MB    1568426536.373210694
      : Allocated   1312 MB    1568426545.114454298
      : Allocated   1320 MB    1568426553.907458337
      : Allocated   1328 MB    1568426562.755416191
      : Allocated   1336 MB    1568426571.653914759
      : Allocated   1344 MB    1568426580.608286966
      : Allocated   1352 MB    1568426589.616587409
      : Allocated   1360 MB    1568426598.675953367
      : Allocated   1368 MB    1568426607.791414660
      : Allocated   1376 MB    1568426616.958166598
      : Allocated   1384 MB    1568426626.174791988
      : Allocated   1392 MB    1568426635.447889150
      : Allocated   1400 MB    1568426644.792675520
      : Allocated   1408 MB    1568426654.180493605
      : Allocated   1416 MB    1568426663.619285064
      : Allocated   1424 MB    1568426673.107065173
      : Allocated   1432 MB    1568426682.646830491
      : Allocated   1440 MB    1568426692.249640525
      : Allocated   1448 MB    1568426701.905185669
      : Allocated   1456 MB    1568426711.613266119
      : Allocated   1464 MB    1568426721.364714743
      : Allocated   1472 MB    1568426731.180335501
      : Allocated   1480 MB    1568426741.41295502 
      : Allocated   1488 MB    1568426750.969546100
      : Allocated   1496 MB    1568426760.953238849
      : Allocated   1504 MB    1568426770.983059704
      : Allocated   1512 MB    1568426781.70928640 
      : Allocated   1520 MB    1568426791.199097923
      : Allocated   1528 MB    1568426801.387189557
      : Allocated   1536 MB    1568426811.629760772
      : Allocated   1544 MB    1568426821.925979462
      : Allocated   1552 MB    1568426832.274194256
      : Allocated   1560 MB    1568426842.676631765
      : Allocated   1568 MB    1568426853.126701802
      : Allocated   1576 MB    1568426863.626612040
      : Allocated   1584 MB    1568426874.183258431
      : Allocated   1592 MB    1568426884.795803164
      : Allocated   1600 MB    1568426895.454103512
      : Allocated   1608 MB    1568426906.169393032
      : Allocated   1616 MB    1568426916.950192997
      : Allocated   1624 MB    1568426927.781801379
      : Allocated   1632 MB    1568426938.661668238
      : Allocated   1640 MB    1568426949.594513018
      : Allocated   1648 MB    1568426960.578228129
      : Allocated   1656 MB    1568426971.611472712
      : Allocated   1664 MB    1568426982.697511334
      : Allocated   1672 MB    1568426993.838254470
      : Allocated   1680 MB    1568427005.41790588 
      : Allocated   1688 MB    1568427016.284342379
      : Allocated   1696 MB    1568427027.588699882
      : Allocated   1704 MB    1568427038.941672005
      : Allocated   1712 MB    1568427050.342135481
      : Allocated   1720 MB    1568427061.809331626
      : Allocated   1728 MB    1568427073.325294884
      : Allocated   1736 MB    1568427084.890949980
      : Allocated   1744 MB    1568427096.511081180
      : Allocated   1752 MB    1568427108.186765430
      : Allocated   1760 MB    1568427119.912499258
      : Allocated   1768 MB    1568427131.703202871
      : Allocated   1776 MB    1568427143.549887670
      : Allocated   1784 MB    1568427155.449689391
      : Allocated   1792 MB    1568427167.403764274
      : Allocated   1800 MB    1568427179.403505169
      : Allocated   1808 MB    1568427191.475610913
      : Allocated   1816 MB    1568427203.591485704
      : Allocated   1824 MB    1568427215.750593256
      : Allocated   1832 MB    1568427227.957340424
      : Allocated   1840 MB    1568427240.221173161
      : Allocated   1848 MB    1568427252.533768530
      : Allocated   1856 MB    1568427264.899089122
      : Allocated   1864 MB    1568427277.326364064
      : Allocated   1872 MB    1568427289.820279521
      : Allocated   1880 MB    1568427302.359054186
      : Allocated   1888 MB    1568427314.949932722
      : Allocated   1896 MB    1568427327.594477301
      : Allocated   1904 MB    1568427340.299098625
      : Allocated   1912 MB    1568427353.50916061 
      : Allocated   1920 MB    1568427365.853542493
      : Allocated   1928 MB    1568427378.715214003
      : Allocated   1936 MB    1568427391.618655373
      : Allocated   1944 MB    1568427404.576634206
      : Allocated   1952 MB    1568427417.584639114
      : Allocated   1960 MB    1568427430.665147529
      : Allocated   1968 MB    1568427443.779689015
      : Allocated   1976 MB    1568427456.955273937
      : Allocated   1984 MB    1568427470.174443595
      : Allocated   1992 MB    1568427483.456611728
      : Allocated   2000 MB    1568427496.788835667
      : Allocated   2008 MB    1568427510.169979857
      : Allocated   2016 MB    1568427523.607343406
      : Allocated   2024 MB    1568427537.105825038
      : Allocated   2032 MB    1568427550.650946889
      : Allocated   2040 MB    1568427564.264384329
      : Allocated   2048 MB    1568427577.923517048
FINAL : Allocated 2147483648 bytes
END   1568427577.927846750
styx$ 


Data above can be isolated and then time-delta extracted with 

styx$ 
styx$ awk 'p{print $1 "  " $2-p}{p=$2}' deb_x86_64.dat > deb_x86_64_tdelta.dat 
styx$ 
styx$ 
styx$ gnuplot 

        G N U P L O T
        Version 5.2 patchlevel 6    last modified 2019-01-01 

        Copyright (C) 1986-1993, 1998, 2004, 2007-2018
        Thomas Williams, Colin Kelley and many others

        gnuplot home:     http://www.gnuplot.info
        faq, bugs, etc:   type "help FAQ"
        immediate help:   type "help"  (plot window: hit 'h')

Terminal type is now 'qt'
gnuplot> plot 'deb_x86_64_tdelta.dat' with linespoints
libGL error: No matching fbConfigs or visuals found
libGL error: failed to load driver: swrast
gnuplot> quit
styx$ 


